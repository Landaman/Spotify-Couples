# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase
on:
  push:
    branches:
      - main

# Concurrency group name ensures concurrent workflow runs wait for any in-progress job to finish
concurrency:
  group: merge-${{ github.ref }}

permissions:
  actions: read # Required by codeQL
  security-events: write # Required by codeQL
  id-token: write # This is required for requesting the JWT
  contents: read # This is required for actions/checkout

jobs:
  lint:
    name: 'Lint'
    uses: ./.github/workflows/lint.yaml
  codeql:
    name: 'CodeQL'
    uses: ./.github/workflows/codeql.yaml
  build_and_deploy:
    needs: [lint, codeql]
    name: 'Build and Deploy'
    runs-on: ubuntu-latest
    environment:
      name: Live
      url: ${{vars.URL}}
    steps:
      - uses: actions/checkout@v4
      - uses: './.github/setup'
      - name: Deploy to Firebase
        uses: w9jds/firebase-action@master
        with:
          args: deploy
        env:
          GCP_SA_KEY: ${{ secrets.FIREBASE_DEPLOY_SERVICE_ACCOUNT }}
          PROJECT_ID: ${{vars.FIREBASE_PROJECT_ID}}
          FIREBASE_CLI_EXPERIMENTS: webframeworks
          PUBLIC_FIREBASE_API_KEY: ${{secrets.FIREBASE_API_KEY}}
          PUBLIC_FIREBASE_AUTH_DOMAIN: ${{vars.FIREBASE_AUTH_DOMAIN}}
          PUBLIC_FIREBASE_PROJECT_ID: ${{vars.FIREBASE_PROJECT_ID}}
          PUBLIC_FIREBASE_STORAGE_BUCKET: ${{vars.FIREBASE_STORAGE_BUCKET}}
          PUBLIC_FIREBASE_MESSAGING_SENDER_ID: ${{secrets.FIREBASE_MESSAGING_SENDER_ID}}
          PUBLIC_FIREBASE_APP_ID: ${{secrets.FIREBASE_APP_ID}}
