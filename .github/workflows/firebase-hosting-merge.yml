# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting
on:
  push:
    branches:
      - main

# Concurrency group name ensures concurrent workflow runs wait for any in-progress job to finish
concurrency:
  group: merge-${{ github.ref }}

permissions:
  actions: read # Required by codeQL
  security-events: write # Required by codeQL
  id-token: write # This is required for requesting the JWT
  contents: read # This is required for actions/checkout

jobs:
  lint:
    name: 'Lint'
    uses: ./.github/workflows/lint.yaml
  codeql:
    name: 'CodeQL'
    uses: ./.github/workflows/codeql.yaml
  build_and_deploy:
    needs: [lint, codeql]
    name: 'Build and Deploy'
    runs-on: ubuntu-latest
    environment:
      name: Live
      url: ${{steps.deploy.outputs.details_url}}
    steps:
      - uses: actions/checkout@v4
      - uses: './.github/setup'
      - uses: FirebaseExtended/action-hosting-deploy@v0
        id: deploy
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_SPOTIFY_COUPLES }}
          channelId: ${{vars.CHANNEL_ID}}
        env:
          FIREBASE_CLI_EXPERIMENTS: webframeworks
          AUTH_TRUST_HOST: true
          AUTH_SECRET: ${{secrets.AUTH_SECRET}}
          AUTH_SPOTIFY_ID: ${{secrets.AUTH_SPOTIFY_ID}}
          AUTH_SPOTIFY_SECRET: ${{secrets.AUTH_SPOTIFY_SECRET}}
